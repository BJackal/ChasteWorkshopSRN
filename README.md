# Delta-Notch and cell polarity SRN modelling project for use with Chaste.

Biological systems are an extensive research area across multiple disciplines. The high level of complexity within these systems due to dependencies on multiple factors makes them challenging to investigate. However, many of these systems can be represented as a network of biochemical reactions. For instance Subcellular Reaction Networks (SRNs) can be used to model multiple biological systems, such as: gene regulation networks, predicting protein-protein interaction networks and many more.

First we need to follow the steps outlined on the chaste website for correctlly initalizing our user project: 
https://chaste.cs.ox.ac.uk/trac/wiki/ChasteGuides/UserProjects

Thus we first must navigate to our Chaste project folder: ```cd /path/to/Chaste/projects```
Then we must clone this project: ``` git clone https://github.com/BJackal/ChasteWorkshopSRN.git```
Now we navigate into our cloned user project from the command line and run our setup: ```python setup_project.py```
Here our project only relies on the cell based portion of Chaste so we answer yes to cell based and no to lung and heart.
Now we are ready to make sure that our project will compile correctly. To do this we use the command line to navigate to our chaste build folder (This should be outside of the main Chaste source folder) and run: ```ccmake path/to/Chaste```
While this is running we will be prompted for an input to configure our project. For this we will press ```c ``` then on completion ```e``` to exit.
Then we will configure with ```c``` onece more, followed up by ```e``` to exit and finally ```g``` to generate.
We are no ready to to make our tests.

To ensure that this has been done correctlly we can build our example test of TestHello and ensure that it passes.
First at the command line we run ```make TestHello``` and on completion we can run the example test using ```ctest -R TestHello$```.
If this test succesfully makes and passes we know that our project is correctlly compiled and working.

Here we will explore two examples of using SRN models in chaste. First, we will explore an example in Chaste of the Delta-Notch signalling pathway. Here we utilise the ODE system presented in the work Collier et al (1996) for the feedback loop between Delta and Notch. The one major difference in our system being that Delta concentrations in the neighbouring cells are used directly.

# Example 1: Delta -Notch Signalling
The test we will be followingfor our first example can be found within /test/TestDeltaNotchSRN. Let's open this file in visual studio code. First we can look over the commented code describing what each line of text is being used for. All files will start out with our relavent includes for which parts of Chaste we wish to utilise and this is also where you woul include any of your own custom code that you may use in your own simulations.

For our first run through we will look at an edge based SRN model for a line of 70 cells. To run this simulation we simply need to go to our command line and input ```make -j4 TestDeltaNotchSRN``` and on completion execute ```ctest -V -R TestDeltaNotchSRN```. To explore our results we will utilise Paraview. In Paraview first navigate to File -> Open. Then navigate to our results, by default this should be /tmp/YourUserName/testoutput/TestDeltaNotchEdgeODESimulation. Opening the results_from_time_0.vtu file. Clicl the green apply button for your cells to appear. Then on the second row of the toolbar there will be two drop down menus defaulted to "Solid colour" and "Surface". Lets change these to "edge delta" and "Surface With Edges". Finally, before playing our simulation we need to modify our colour bar for the entire time series of the simulation. To do this we can click the 6th button on the second row of the toolbars ( This should be a green arrow pointing in two directions with a small t) then click rescale when prompted withthe disable automatic rescaling option. Now we can play our simulation and watch how the edge based Delta evolves over time in the simulation. Similarlly, we can also change from our "edge delta" to "edge notch" to view how that also changes in time. 

If we wished to explore and plot how a given edges cocnentration of delta and notch changed in time we need to first click the "Select Cells On" button (This looks like a green triangle surrounded by a dotted box) then select our given edge. here lets click left hand edge of the second cell conencting to its neigbhour. Then simply navigate to Filters -> Data Analysis -> Plot Selection Over time. Then click the green apply button.This will create a graph showing all parameters on that edge, for now lets turn off all parameters except edge notch and edge delta. Now we can see how our concentrations of Delta and Notch evolve on this edge in time. Try this across multiple edges between neighbours to see how each individual edge evolves in time.

Now for our second run lets change some of the parameters in our simulation to create some new behaviour. First, lets make our simulation into a 2D tissue instead of a line of cells. To do this lets change line 101 on our code from ```HoneycombVertexMeshGenerator generator (70,1)``` to  ```HoneycombVertexMeshGenerator generator (6,6)```. This will give us tissue of 6 by 6 cells. Re-run the simulation again using ```make -j4 TestDeltaNotchSRN``` and  ```ctest -V -R TestDeltaNotchSRN``` then view how this looks in paraview.  

In addition we can also add some proliferation and movement to our cells. To do this lets first change line 114 from ```NoCellCycleModel* p_cc_model = new NoCellCycleModel``` to ```UnifromG1GenerationCellCycleModel* p_cc_model = new UnifromG1GenerationCellCycleModel```. This means our cells will now have a stochastic cell cycle model, allowing for our cells to grow and divide based on their phases. This will assign our cells phases for growth and division events from a uniform distribution. This was used in the work of Meinke et al (2001) for their off lattice model of the intestinal crypt. In addition we also want to add a target area modifier for our cells so that they know the volume they want to be at, to do this lets uncomment line 195 and 196 in the code. Finally, we may want to add a force to our simulation to give our cells some movement, to do this lets uncomment line 192 and 193. This will pass a Farhardifar force to our cells. Now we are ready to run our simulation again so lets run ```make -j4 TestDeltaNotchSRN``` and  ```ctest -V -R TestDeltaNotchSRN``` again as previously. This may take a little longer to run than previous due to the addition of cell proliferation in our system. Viewing the simulation results in paraview you will be able to see a much more dynamic system than previously. First of all, as our cells grown and divide you should be able to notice several cell transitions including T1 with edge swapping and T2 where smaller cells dissapear. 

You can play around with the simulation more trying different cell configurations as either 2D tissues or 1D cells lines. Simillarly you can also investigate how changing the initial conditions in our simulation, such as Delta and Notch, may lead to different end states for your simulation.

# Example 2: Planar polarity. 

Another use case for edge based SRN simulations is modelling planar polarity in epethelial tissues. Planar polarity(PP) is a form of protein mediated patterning across tissue due to signalling. Creating distinctive patterns across large length scales in many tissues. For example, in the wing of the Drasophila fruit fly wings there are many hairs across the wings used for sensory pruposes. These hairs have been noted to be all pointing from the proximal side of wings out towards the distal end. It has been found that there is a set of core proteins in the Drosophila wings which which create a simillar patterning on the cellular to tissue scale. This pattern is formed by two main proteins Frizzled(Fz) and Strabismus (Stb). These proteins then localise proximally and or distally based on positive feedback with their own species and ihibit the binding of the opposite protein on the same edge. Fz and Stb binding at cellular junctions to Flamingo (Fl) homodimers which bind across junctions.

Here we will investigate a simplified version in our simulation focusing on only three "protein" species: A, B and C. In our case we will assume that A can form homodimers with its own species in neighbouring cells edges and that B and C can then bind to these homodimers. First lets open up our test again, this can be found under /test/Test_Polarity. In addition, as we will be utilising some code for this simulation outside of the Chaste source doe you can find that we have several additional polarity files under ChasteWorkshopSRN/src. It is good practice to always keep any of your code which you will be editing as part of your project within this section and not directlly editing underlying Chaste source code. This is so if any issues arise it will be easier to ascertain if the new code or something else is causing the issue.

First lets open up our test again and take a look around. By default we can see that we have set up a 6 by 6 grid of cells and that we only initialise or simulation with the none bound Proteins A,B and C. We utilise an "offset" for initalising our B concentration, this acts as an initial global signal for around 0.001% to be localised greater in the distall direction and less on the proximal edges. Simillar to before, we again start with no force or cell cycle model present in our simulation.

Following previous steps we can already run our simulation by executing ```make -j4 TestPolaritySRN``` and on completion execute ```ctest -V -R TestPolaritySRN```. Then you can launch the simulation results in paraview and investigate how polarity forms across our small tissue in time. You can use the previous methods described in Example 1 to investigate the evolution of the protein species over time to investiagte how our species interact with each other.

Now lets try to edit some of the underlying source code in our Cahste/projects/ChasteWorkShopSRN/src folder. Lets open PolarityEdgeTrackingModifier.cpp. This file contains several underlying functions for keeping track of cellular edge data. On line 38 you will find the class variable```mUnboundProteinDiffusionCoefficient(0.03)```. This represents our proteins diffusion rates and is utilised in the function ```UpdateCellData``` for diffusion of proteins around our cells edges. Trying reducing or increasing this coefficient then save your changes. Now that we have updated this underlying src file we will need to cmake our build folder again. To do this lets go back to our build folder (outside the main chaste soruce code folder) and run at command line ```cmake /path/to/Chaste/``` then ```make -j4 TestPolaritySRN``` and on completion execute ```ctest -V -R TestPolaritySRN```. Opening up the results in paraview what change if any do you find to the temoporal behavioru of the proteins compared to the original diffusion coefficient ?

As we have only previously utilised a uniform vertex mesh so far, lets go back to our test file and comment out line 111 and repalce this by uncommenting line 112. This will switch out our uniform vertex mesh for a more dynamic Voronoi vertex mesh. This will create a dynamic mesh with cells edges defined based on distances from each others centres. Now re-run your simulation to view how this looks in paraview and compare it to the previous uniform mesh.

Simillar to in Example 1 lets also repalce our ```NoCellCycleModel* p_cc_model = new NoCellCycleModel``` on line 122 to ```UnifromG1GenerationCellCycleModel* p_cc_model = new UnifromG1GenerationCellCycleModel```. Simillarly, lets Uncomment lines 
202 - 206. This will allow our cells to grow and divide. Split their concentrations and creating a much more dynamic simulation than we initially started out with. 

You could further explore this test by altering the initial conditions of our A,B and C concentrations. For example, how does your final simulation result change if you give none equal cocnentrations of the initial proteins ? How is the end result effected if we "flood" the simulation with a higher initial cocnentraiton of the A homodimer forming protein. You could also try increasing or decreasing the initial bias caused by the offset. How does altering this effect your end results.


